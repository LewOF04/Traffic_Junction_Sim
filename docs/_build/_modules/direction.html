

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>direction &mdash; Traffic Wizard 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8d563738"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Traffic Wizard
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Traffic Wizard</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">direction</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for direction</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">src.lane</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lane</span>
<div class="viewcode-block" id="Direction">
<a class="viewcode-back" href="../direction.html#direction.Direction">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Direction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Description: The class object containing all direction information</span>

<span class="sd">    Attributes:</span>
<span class="sd">        directionName(string): the name of the direction</span>
<span class="sd">        lightTime(float): the time that the light for this direction should be on for</span>
<span class="sd">        lanes(Dictionary): the dictionary containing all of the lanes</span>
<span class="sd">        VPHFlowDirections(array(int)): the VPH for each heading for this direction (Left, Straight, Right)</span>
<span class="sd">        laneLayout(array(string)): the array of strings inidcating the types of lanes in the direction</span>

<span class="sd">    Methods:</span>
<span class="sd">        __init__(self, flows, name, laneInput, inputInformation): initialises the direction object</span>
<span class="sd">        hasTraffic(self): indicates whether or not there is any traffic within this direction</span>
<span class="sd">        distributeVehiclesByLane(self): distributes the VPH for this direction between the lanes optimally</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Direction.__init__">
<a class="viewcode-back" href="../direction.html#direction.Direction.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flows</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">laneInput</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Description: initialises the direction object</span>

<span class="sd">        Args:</span>
<span class="sd">            flows(Array(int)): an array of the VPH for each exit direction for this junction entrance</span>
<span class="sd">            name(string): the name of the direction (north, east, south, west)</span>
<span class="sd">            laneInput(Array(String)): an array of what types of lanes are within this junction entrance</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directionName</span> <span class="o">=</span> <span class="n">name</span>  <span class="c1"># the name of the direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lightTime</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the time that the light will be on in this direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># a dictionary to store all of the lane objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span> <span class="o">=</span> <span class="n">flows</span>  <span class="c1"># the array storing the directions of traffic [Left, Straight, Right]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laneLayout</span> <span class="o">=</span> <span class="n">laneInput</span>  <span class="c1"># the layout of the lanes in the junction</span>

        <span class="c1"># creates lane objects for each direction type provided that these lanes exist</span>
        <span class="n">leftNum</span> <span class="o">=</span> <span class="n">laneInput</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span>  <span class="c1"># counts the number of left turning lanes for this direction</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">leftNum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>  <span class="c1"># if there exists a left turn lane</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Lane</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">leftNum</span><span class="p">)]</span> <span class="c1"># adds the left lane to the lanes dict</span>

        <span class="n">cycleOrBusNum</span> <span class="o">=</span> <span class="n">laneInput</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;CB&#39;</span><span class="p">)</span>  <span class="c1"># cycleOrBus</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cycleOrBusNum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Lane</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cycleOrBusNum</span><span class="p">)]</span> <span class="c1"># adds the cycle or bus lane to the lanes dict</span>

        <span class="n">leftStraightNum</span> <span class="o">=</span> <span class="n">laneInput</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;LS&#39;</span><span class="p">)</span>  <span class="c1"># left or straight lane</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">leftStraightNum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Lane</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">leftStraightNum</span><span class="p">)]</span> <span class="c1"># adds the left or straight lane to the lanes dict</span>

        <span class="n">leftRightStraightNum</span> <span class="o">=</span> <span class="n">laneInput</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;LRS&#39;</span><span class="p">)</span>  <span class="c1"># left, right or straight lane</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">leftRightStraightNum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LRS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Lane</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">leftRightStraightNum</span><span class="p">)]</span> <span class="c1"># adds the left or right or straight lane to the lanes dict</span>

        <span class="n">straightNum</span> <span class="o">=</span> <span class="n">laneInput</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>  <span class="c1"># straight lane</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">straightNum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Lane</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">straightNum</span><span class="p">)]</span> <span class="c1"># adds the straight lane to the lanes dict</span>

        <span class="n">leftRightNum</span> <span class="o">=</span> <span class="n">laneInput</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;LR&#39;</span><span class="p">)</span>  <span class="c1"># left or right lane</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">leftRightNum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Lane</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">leftRightNum</span><span class="p">)]</span> <span class="c1"># adds the left or right lane to the lanes dict</span>

        <span class="n">rightStraightNum</span> <span class="o">=</span> <span class="n">laneInput</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;RS&#39;</span><span class="p">)</span>  <span class="c1"># right or straight lane</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rightStraightNum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Lane</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rightStraightNum</span><span class="p">)]</span> <span class="c1"># adds the right or straight lane to the lanes dict</span>

        <span class="n">rightNum</span> <span class="o">=</span> <span class="n">laneInput</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>  <span class="c1"># right lane</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rightNum</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Lane</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rightNum</span><span class="p">)]</span> <span class="c1"># adds the right lane to the lanes dict</span></div>


<div class="viewcode-block" id="Direction.hasTraffic">
<a class="viewcode-back" href="../direction.html#direction.Direction.hasTraffic">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">hasTraffic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks through each lane to see if there is any traffic within the queues</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if there is traffic in any lane, False if there is no traffic</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">lanes</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>  <span class="c1"># iterates through the values (lane objects) in the lanes dictionary</span>
            <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">getQueueSize</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>  <span class="c1"># checks whether there is traffic in the lane object</span>
                    <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># if there is traffic then return true</span>
        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># otherwise if there is no traffic in any of the lanes</span></div>


<div class="viewcode-block" id="Direction.distributeVehiclesByLane">
<a class="viewcode-back" href="../direction.html#direction.Direction.distributeVehiclesByLane">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">distributeVehiclesByLane</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Distribute the vehicle traffic through all of the lanes within this direction to balance vehicle flows optimally</span>

<span class="sd">        Args:</span>
<span class="sd">            self - the direction which is being distributed</span>

<span class="sd">        Methods:</span>
<span class="sd">            distributeLRorLRS(laneType): handles traffic distribution if there is an LR or LRS lane in the direction</span>
<span class="sd">            distributeS(): handles traffic distribution if there is an S lane in the direction</span>
<span class="sd">            distributeElse(): handles traffic distribution if there is no LRS, LR or S lane in the junction</span>
<span class="sd">            maxRSGTminRight(maxRS, minRight, changeMade, RCounter): moves right traffic from RS to R</span>
<span class="sd">            maxLSGTminLeft(maxLS, minLeft, changeMade, LCounter): moves left traffic from LS to L</span>
<span class="sd">            maxLSGTminStraight(maxLS, minStraight, changeMade, SCounter): moves straight traffic from LS to S</span>
<span class="sd">            maxRSGTminStraight(maxRS, minStraight, changeMade, SCounter): moves straight traffic from RS to S</span>
<span class="sd">            maxLSGTmaxRS(maxLS, maxRS, changeMade): moves straight traffic from LS to RS</span>
<span class="sd">            maxRSGTmaxLS(maxRS, maxLS, changeMade): moves straight traffic from RS to LS</span>
<span class="sd">            minRightGTmaxRS(minRight, maxRS, changeMade, RCounter): moves right traffic from R to RS</span>
<span class="sd">            minLeftGTmaxLS(minLeft, maxLS, changeMade, LCounter): moves left traffic from L to LS</span>
<span class="sd">            minStraightGTmaxRS(minStraight, maxRS, changeMade, SCounter): moves straight traffic from S to RS</span>
<span class="sd">            minStraightGTmaxLS(minStraight, maxLS, changeMade, SCounter): moves straight traffic from S to LS</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># self.VPHFlowDirections - the traffic directions in the form [left, straight, right, cycleOrBus]</span>
        <span class="c1"># self.lanes - a dictionary of lane objects, with the keys &#39;L&#39;, &#39;CB&#39;, &#39;LS&#39;, &#39;LRS&#39;, &#39;S&#39;, &#39;LR&#39;, &#39;RS&#39;, &#39;R&#39;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">maxRSGTminRight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: if maxRS is greater than minRight and there is right traffic in RS, add right traffic from RS to R</span>

<span class="sd">            Args:</span>
<span class="sd">                maxRS(int): the flow in the RS lane</span>
<span class="sd">                minRight(int): the lowest flow out of the R lanes</span>
<span class="sd">                changeMade(bool): whether or not a change has been made </span>
<span class="sd">                RCounter(int): the counter to iterate through R lanes</span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                int: maxRS - the updated maxRS variable</span>
<span class="sd">                int: minRight - the updated minRight variable</span>
<span class="sd">                bool: changeMade - whether a change has been made</span>
<span class="sd">                int: RCounter - the updated counter of R lanes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="bp">self</span>
            <span class="c1">#if maxRS is greater than minRight and there is right traffic in RS</span>
            <span class="k">if</span><span class="p">((</span><span class="n">maxRS</span> <span class="o">&gt;</span> <span class="n">minRight</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">directionFlow</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="c1">#add right traffic from RS to R</span>
                <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">RCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                    
                <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>

                <span class="n">RCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">RCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
            
            <span class="k">return</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span>
        
        <span class="k">def</span><span class="w"> </span><span class="nf">maxLSGTminLeft</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: if maxLS is greater than minLeft and there is left traffic in LS, add left traffic from LS to L</span>

<span class="sd">            Args:</span>
<span class="sd">                maxLS(int): the flow in the LS lane</span>
<span class="sd">                minLeft(int): the lowest flow out of the L lanes</span>
<span class="sd">                changeMade(bool): whether or not a change has been made </span>
<span class="sd">                LCounter(int): the counter to iterate through L lanes</span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                int: maxLS - the updated maxLS variable</span>
<span class="sd">                int: minLeft - the updated minLeft variable</span>
<span class="sd">                bool: changeMade - whether a change has been made</span>
<span class="sd">                int: LCounter - the updated counter of L lanes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="bp">self</span>
            <span class="c1">#if maxLS is greater than minLeft and there is left traffic in LS</span>
            <span class="k">if</span><span class="p">((</span><span class="n">maxLS</span> <span class="o">&gt;</span> <span class="n">minLeft</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">directionFlow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="c1">#add left traffic from LS to L</span>
                <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="n">LCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>

                <span class="n">LCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">LCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span>
        
        <span class="k">def</span><span class="w"> </span><span class="nf">maxLSGTminStraight</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: if maxLS is greater than the minimum straight and there is straight traffic in LS, add straight traffic from LS to S</span>

<span class="sd">            Args:</span>
<span class="sd">                maxLS(int): the flow in the LS lane</span>
<span class="sd">                minStraight(int): the lowest flow out of the S lanes</span>
<span class="sd">                changeMade(bool): whether or not a change has been made </span>
<span class="sd">                SCounter(int): the counter to iterate through S lanes</span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                int: maxLS - the updated maxLS variable</span>
<span class="sd">                int: minStraight - the updated minStraight variable</span>
<span class="sd">                bool: changeMade - whether a change has been made</span>
<span class="sd">                int: SCounter - the updated counter of S lanes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="bp">self</span>
            <span class="c1">#if maxLS is greater than the minimum straight and there is straight traffic in LS</span>
            <span class="k">if</span><span class="p">((</span><span class="n">maxLS</span> <span class="o">&gt;</span> <span class="n">minStraight</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">directionFlow</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="c1">#add straight traffic from LS to S</span>
                <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">][</span><span class="n">SCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                <span class="n">SCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">SCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
            
            <span class="k">return</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span>
        
        <span class="k">def</span><span class="w"> </span><span class="nf">maxRSGTminStraight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: if maxRS is greater than the minimum straight and there is straight traffic in RS, add straight traffic from RS to S</span>
<span class="sd">            Args:</span>
<span class="sd">                maxRS(int): the flow in the RS lane</span>
<span class="sd">                minStraight(int): the lowest flow out of the S lanes</span>
<span class="sd">                changeMade(bool): whether or not a change has been made </span>
<span class="sd">                SCounter(int): the counter to iterate through S lanes</span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                int: maxRS - the updated maxRS variable</span>
<span class="sd">                int: minStraight - the updated minStraight variable</span>
<span class="sd">                bool: changeMade - whether a change has been made</span>
<span class="sd">                int: SCounter - the updated counter of S lanes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="bp">self</span>
            <span class="c1">#if maxRS is greater than the minimum straight and there is straight traffic in RS</span>
            <span class="k">if</span><span class="p">((</span><span class="n">maxRS</span> <span class="o">&gt;</span> <span class="n">minStraight</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">directionFlow</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="c1">#add straight traffic from RS to S</span>
                <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">][</span><span class="n">SCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                <span class="n">SCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">SCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
            
            <span class="k">return</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">maxLSGTmaxRS</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: if maxLS is greater than maxRS and LS has some straight traffic, move S traffic from LS to RS</span>
<span class="sd">            Args:</span>
<span class="sd">                maxRS(int): the flow in the RS lane</span>
<span class="sd">                maxLS(int): the flow in the LS lane</span>
<span class="sd">                changeMade(bool): whether or not a change has been made </span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                int: maxRS - the updated maxRS variable</span>
<span class="sd">                int: maxLS - the updated maxLS variable</span>
<span class="sd">                bool: changeMade - whether a change has been made</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="bp">self</span>
            <span class="c1">#if maxLS is greater than maxRS and LS has some straight traffic</span>
            <span class="k">if</span><span class="p">((</span><span class="n">maxLS</span> <span class="o">&gt;</span> <span class="n">maxRS</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">directionFlow</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">maxLS</span> <span class="o">!=</span> <span class="p">(</span><span class="n">maxRS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))):</span>
                <span class="c1">#move S traffic from LS to RS</span>
                <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
            
            <span class="k">return</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">maxRSGTmaxLS</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: if maxRS is greater than maxLS and RS has some straight traffic, move S traffic from RS to LS</span>
<span class="sd">            Args:</span>
<span class="sd">                maxRS(int): the flow in the RS lane</span>
<span class="sd">                maxLS(int): the flow in the LS lane</span>
<span class="sd">                changeMade(bool): whether or not a change has been made </span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                int: maxRS - the updated maxRS variable</span>
<span class="sd">                int: maxLS - the updated maxLS variable</span>
<span class="sd">                bool: changeMade - whether a change has been made</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="bp">self</span>
            <span class="c1">#if maxRS is greater than maxLS and RS has some straight traffic</span>
            <span class="k">if</span><span class="p">((</span><span class="n">maxRS</span> <span class="o">&gt;</span> <span class="n">maxLS</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">directionFlow</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">maxRS</span> <span class="o">!=</span> <span class="p">(</span><span class="n">maxLS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))):</span>
                <span class="c1">#move S traffic from RS to LS</span>
                <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
            
            <span class="k">return</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">minRightGTmaxRS</span><span class="p">(</span><span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: if minRight is greater than maxRS, move right traffic from R to RS</span>
<span class="sd">            Args:</span>
<span class="sd">                maxRS(int): the flow in the RS lane</span>
<span class="sd">                minRight(int): the lowest flow out of the R lanes</span>
<span class="sd">                changeMade(bool): whether or not a change has been made </span>
<span class="sd">                RCounter(int): the counter to iterate through R lanes</span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                int: maxRS - the updated maxRS variable</span>
<span class="sd">                int: minRight - the updated minRight variable</span>
<span class="sd">                bool: changeMade - whether a change has been made</span>
<span class="sd">                int: RCounter - the updated counter of R lanes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="bp">self</span>
            <span class="c1">#if minRight is greater than maxRS</span>
            <span class="k">if</span><span class="p">((</span><span class="n">minRight</span> <span class="o">&gt;</span> <span class="n">maxRS</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">minRight</span> <span class="o">!=</span> <span class="p">(</span><span class="n">maxRS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))):</span>
                <span class="c1">#move right traffic from R to RS</span>
                <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">RCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>

                <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>

                <span class="n">RCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">RCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
            
            <span class="k">return</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">minLeftGTmaxLS</span><span class="p">(</span><span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: if minLeft is greater than maxLS, move left traffic from L to LS</span>
<span class="sd">            Args:</span>
<span class="sd">                maxLS(int): the flow in the LS lane</span>
<span class="sd">                minLeft(int): the lowest flow out of the L lanes</span>
<span class="sd">                changeMade(bool): whether or not a change has been made </span>
<span class="sd">                LCounter(int): the counter to iterate through L lanes</span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                int: maxLS - the updated maxLS variable</span>
<span class="sd">                int: minLeft - the updated minLeft variable</span>
<span class="sd">                bool: changeMade - whether a change has been made</span>
<span class="sd">                int: LCounter - the updated counter of L lanes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="bp">self</span>
            <span class="c1">#if minLeft is greater than maxLS</span>
            <span class="k">if</span><span class="p">((</span><span class="n">minLeft</span> <span class="o">&gt;</span> <span class="n">maxLS</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">minLeft</span> <span class="o">!=</span> <span class="p">(</span><span class="n">maxLS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))):</span>
                <span class="c1">#move left traffic from L to LS</span>
                <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="n">LCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>

                <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>

                <span class="n">LCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">LCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
            
            <span class="k">return</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">minStraightGTmaxRS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: if minStraight is greater than maxRS, move straight traffic from S to RS</span>
<span class="sd">            Args:</span>
<span class="sd">                maxRS(int): the flow in the RS lane</span>
<span class="sd">                minStraight(int): the lowest flow out of the S lanes</span>
<span class="sd">                changeMade(bool): whether or not a change has been made </span>
<span class="sd">                SCounter(int): the counter to iterate through S lanes</span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                int: maxRS - the updated maxRS variable</span>
<span class="sd">                int: minStraight - the updated minStraight variable</span>
<span class="sd">                bool: changeMade - whether a change has been made</span>
<span class="sd">                int: SCounter - the updated counter of S lanes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="bp">self</span>
            <span class="c1">#if minStraight is greater than maxRS</span>
            <span class="k">if</span><span class="p">((</span><span class="n">minStraight</span> <span class="o">&gt;</span> <span class="n">maxRS</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">minStraight</span> <span class="o">!=</span> <span class="p">(</span><span class="n">maxRS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))):</span>
                <span class="c1">#move straight traffic from S to RS</span>
                <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">][</span><span class="n">SCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>

                <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                <span class="n">SCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">SCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
            
            <span class="k">return</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">minStraightGTmaxLS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: if minStraight is greater than maxLS, move straight traffic from S to LS</span>
<span class="sd">            Args:</span>
<span class="sd">                maxLS(int): the flow in the LS lane</span>
<span class="sd">                minStraight(int): the lowest flow out of the S lanes</span>
<span class="sd">                changeMade(bool): whether or not a change has been made </span>
<span class="sd">                SCounter(int): the counter to iterate through S lanes</span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                int: maxLS - the updated maxLS variable</span>
<span class="sd">                int: minStraight - the updated minStraight variable</span>
<span class="sd">                bool: changeMade - whether a change has been made</span>
<span class="sd">                int: SCounter - the updated counter of S lanes</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1">#if minStraight is greater than maxLS</span>
            <span class="k">if</span><span class="p">((</span><span class="n">minStraight</span> <span class="o">&gt;</span> <span class="n">maxLS</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">minStraight</span> <span class="o">!=</span> <span class="p">(</span><span class="n">maxLS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))):</span>
                <span class="c1">#move straight traffic from S to LS</span>
                <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">][</span><span class="n">SCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>

                <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                <span class="n">SCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">SCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
        
            <span class="k">return</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span>
        

        <span class="k">def</span><span class="w"> </span><span class="nf">distributeLRorLRS</span><span class="p">(</span><span class="n">laneType</span><span class="p">):</span>
            <span class="k">nonlocal</span> <span class="bp">self</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: This function performs the vehicle distribution when there is an LR or an LRS lane within the junction.</span>

<span class="sd">            Args:</span>
<span class="sd">                laneType(string): a string of either LR or LRS depending on the type of lane</span>
<span class="sd">            &quot;&quot;&quot;</span>
            
            <span class="n">LCounter</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

            <span class="c1"># firstly the traffic is evenly divided between the purely left turn lanes and the purely right turn lanes</span>
            <span class="k">if</span> <span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">:</span>  <span class="c1"># checks if there is a left turn lane in the junction</span>
                <span class="c1"># if there is a left turn lane, distribute the left-turn traffic between the left lanes</span>
                <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                        <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>

                <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># otherwise if there are no left lanes, then all left turn traffic should be added to the LR/LRS lane</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>  <span class="c1"># adds the left traffic to the lane</span>

            <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">:</span>  <span class="c1"># if there is a right turn lane in the junction</span>
                <span class="c1"># divide the right turn traffic amongst the right turn lanes</span>
                <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the right direction</span>
                <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                        <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided amount and the remainder</span>
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane</span>

                <span class="c1"># find the right turn lane with the maximum flow</span>
                <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># otherwise if there are no right lanes, then all right turn traffic should be added to the LR/LRS lane</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>  <span class="c1"># adds the right traffic to the lane</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">laneType</span> <span class="o">==</span> <span class="s1">&#39;LRS&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>  <span class="c1"># add all of the straight lane flow to the LRS lane</span>

            <span class="c1"># if there are both left turn lanes and right turn lanes</span>
            <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                <span class="c1"># if the right turn lanes have higher flow than the left turn lanes</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">maxRight</span> <span class="o">&gt;</span> <span class="n">maxLeft</span><span class="p">):</span>
                    <span class="c1"># while the maxRight is more than the left and whilst the maxRight is more than the LR/LRS lane</span>
                    <span class="k">while</span> <span class="p">((</span><span class="n">maxRight</span> <span class="o">&gt;</span> <span class="n">maxLeft</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">maxRight</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">RCounter</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span><span class="p">:</span>  <span class="c1"># as long as the lane is less than the the LR/LRS lane</span>
                            <span class="c1"># add one flow from the lane to the LR/LRS lane</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">RCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1"># update the RCounter</span>
                        <span class="n">RCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">RCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>

                        <span class="c1"># update the maximum right flow</span>
                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>

                <span class="c1"># if the left turn lanes have a higher flow than the right turn lanes</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">maxLeft</span> <span class="o">&gt;</span> <span class="n">maxRight</span><span class="p">):</span>
                    <span class="c1"># while the maxLeft is more than the right and whilst the maxLeft is more than the LR/LRS lane</span>
                    <span class="k">while</span> <span class="p">((</span><span class="n">maxLeft</span> <span class="o">&gt;</span> <span class="n">maxRight</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">maxLeft</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="n">LCounter</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span><span class="p">:</span>  <span class="c1"># as long as the lane is more than the the LR/LRS lane</span>
                            <span class="c1"># add one flow from the lane to the LR/LRS lane</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="n">LCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1"># update the LCounter</span>
                        <span class="n">LCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">LCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>

                        <span class="c1"># update the maxLeft variable</span>
                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>

                <span class="c1"># if either the maxLeft and maxRight is still greater than the LR/LRS lane after it&#39;s been distributed, we distribute from both lanes to the LR</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">maxLeft</span><span class="p">,</span> <span class="n">maxRight</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span><span class="p">):</span>
                    <span class="c1"># iterate until the LR/LRS is &gt;= the maxLeft or maxRight</span>
                    <span class="k">while</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">maxLeft</span><span class="p">,</span> <span class="n">maxRight</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span><span class="p">):</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="n">LCounter</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span><span class="p">:</span>  <span class="c1"># as long as the lane is less than the the LR/LRS lane</span>
                            <span class="c1"># add one flow from the lane to the LR/LRS lane</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="n">LCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1"># update the LCounter</span>
                        <span class="n">LCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">LCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">RCounter</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span><span class="p">:</span>  <span class="c1"># as long as the lane is less than the the LR/LRS lane</span>
                            <span class="c1"># add one flow from the lane to the LR/LRS lane</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">RCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1"># update the RCounter</span>
                        <span class="n">RCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">RCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>

                        <span class="c1"># updates the maxLeft variable</span>
                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>

                        <span class="c1"># updates the maxRight variable</span>
                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>

            <span class="c1"># if there is not any left turn lanes but there are right turn lanes</span>
            <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;L&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                <span class="c1"># while the maxRight is higher than the LR/LRS lane</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">maxRight</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span><span class="p">):</span>
                    <span class="c1"># iterate over the right-turn lanes</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">RCounter</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span><span class="p">:</span>  <span class="c1"># as long as the lane is less than the the LR/LRS lane</span>
                        <span class="c1"># add one flow from the lane to the LR/LRS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">RCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                    <span class="c1"># update the RCounter</span>
                    <span class="n">RCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">RCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>

                    <span class="c1"># update the maxRight flow</span>
                    <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>

            <span class="c1"># if there is not any right turn lanes but there are left turn lanes</span>
            <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                <span class="c1"># while the maxLeft is greater than the LR/LRS variable</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">maxLeft</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="n">LCounter</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span><span class="p">:</span>  <span class="c1"># as long as the lane is less than the the LR/LRS lane</span>
                        <span class="c1"># add one flow from the lane to the LR/LRS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="n">LCounter</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sub&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="n">laneType</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                    <span class="c1"># update the LCounter</span>
                    <span class="n">LCounter</span> <span class="o">=</span> <span class="p">(</span><span class="n">LCounter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>

                    <span class="c1"># update the maxLeft variable</span>
                    <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>


        <span class="k">def</span><span class="w"> </span><span class="nf">distributeS</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: Distributes the traffic if there is an S lane in the direction</span>

<span class="sd">            Methods:</span>
<span class="sd">                </span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="bp">self</span>

            <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">):</span>
                    <span class="c1">#distribute the left-turn traffic between the left lanes</span>
                    <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]))</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                    <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]))</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
            
                    <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                    <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                    <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                            <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                            <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>

                    <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                    <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">):</span>
                    <span class="c1">#divide the right turn traffic amongst the right turn lanes</span>
                    <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]))</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                    <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]))</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
            
                    <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                    <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the right direction</span>
                    <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                            <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided amount and the remainder</span>
                            <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided lane flow</span>

                <span class="c1">#distributes the straight traffic between the S lanes</span>
                <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                        <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># defines initial values for maximum left and straight lane and maximum right and straight lane</span>
                <span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                <span class="n">RCounter</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

                <span class="c1"># if all pure lane types in the junction</span>
                <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>

                    <span class="c1"># if a left and straight and right and straight lane in the junction</span>
                    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>

                        <span class="c1">#distribute the left-turn traffic between the left lanes and LS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>
                
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>

                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>


                        <span class="c1">#divide the right turn traffic amongst the right turn lanes and RS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the right direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided lane flow</span>
                        
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span> <span class="c1">#adds the right traffic to the RS lane</span>

                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        

                        <span class="c1">#distributes the straight traffic between the S, RS and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

                        <span class="c1"># find the straight lane with the maximum flow</span>
                        <span class="n">maxStraight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
                        <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                        <span class="c1">#add the straight traffic to the LS and RS lanes</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#sets maxRS and maxLS</span>
                        <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                        <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>

                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">maxRSGTminRight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">maxLSGTminLeft</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxLSGTminStraight</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxRSGTminStraight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxLSGTmaxRS</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                                
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxRSGTmaxLS</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                            
                            <span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">minRightGTmaxRS</span><span class="p">(</span><span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                            <span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">minLeftGTmaxLS</span><span class="p">(</span><span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxRS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxLS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>

                    <span class="c1"># if a right and straight lane but not a left and straight lane in the junction</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>

                        <span class="c1">#distribute the left-turn traffic between the left lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>

                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>


                        <span class="c1">#divide the right turn traffic amongst the right turn lanes and RS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the right direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided lane flow</span>
                        
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span> <span class="c1">#adds the right traffic to the RS lane</span>

                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        

                        <span class="c1">#distributes the straight traffic between the S, RS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

                        <span class="c1"># find the straight lane with the maximum flow</span>
                        <span class="n">maxStraight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
                        <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                        <span class="c1">#add the straight traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#sets maxRS</span>
                        <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>

                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">maxRSGTminRight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>

                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxRSGTminStraight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">minRightGTmaxRS</span><span class="p">(</span><span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxRS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>

                    <span class="c1"># if a left and straight lane but not a right and straight lane in the junction</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="c1">#distribute the left-turn traffic between the left lanes and LS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>
                
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>

                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>


                        <span class="c1">#divide the right turn traffic amongst the right turn lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the right direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided lane flow</span>

                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        

                        <span class="c1">#distributes the straight traffic between the S and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

                        <span class="c1"># find the straight lane with the maximum flow</span>
                        <span class="n">maxStraight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
                        <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                        <span class="c1">#add the straight traffic to the LS lanes</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#sets maxLS</span>
                        <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">maxLSGTminLeft</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxLSGTminStraight</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">minLeftGTmaxLS</span><span class="p">(</span><span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxLS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>

                <span class="c1">##########################################################</span>
                <span class="c1"># if S and R in the junction but not L</span>
                <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;L&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>

                    <span class="c1"># if RS is in the lanes and LS</span>
                    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>  <span class="c1"># add all left turn traffic to the LS lane</span>

                        <span class="c1">#divide the right turn traffic amongst the right turn lanes and RS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the right direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided lane flow</span>
                        
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span> <span class="c1">#adds the right traffic to the RS lane</span>

                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        

                        <span class="c1">#distributes the straight traffic between the S, RS and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

                        <span class="c1"># find the straight lane with the maximum flow</span>
                        <span class="n">maxStraight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
                        <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                        <span class="c1">#add the straight traffic to the LS and RS lanes</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#sets maxRS and maxLS</span>
                        <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                        <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>

                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">maxRSGTminRight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxLSGTminStraight</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxRSGTminStraight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxLSGTmaxRS</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                                
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxRSGTmaxLS</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                            
                            <span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">minRightGTmaxRS</span><span class="p">(</span><span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxRS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxLS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>

                    <span class="c1"># if LS in lanes but not RS</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;RS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>  <span class="c1"># add all left turn traffic to the LS lane</span>

                        <span class="c1">#divide the right turn traffic amongst the right turn lanes and RS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the right direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided lane flow</span>

                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        

                        <span class="c1">#distributes the straight traffic between the S and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

                        <span class="c1"># find the straight lane with the maximum flow</span>
                        <span class="n">maxStraight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
                        <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                        <span class="c1">#add the straight traffic to the LS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#sets maxLS</span>
                        <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxLSGTminStraight</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxLS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>

                    <span class="c1">#if RS in lanes but not LS</span>
                    <span class="k">elif</span><span class="p">((</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;LS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>

                        <span class="c1">#divide the right turn traffic amongst the right turn lanes and RS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the right direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided lane flow</span>
                        
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span> <span class="c1">#adds the right traffic to the RS lane</span>

                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        

                        <span class="c1">#distributes the straight traffic between the S, RS and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

                        <span class="c1"># find the straight lane with the maximum flow</span>
                        <span class="n">maxStraight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
                        <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                        <span class="c1">#add the straight traffic to the RS lanes</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#sets maxRS </span>
                        <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>

                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">maxRSGTminRight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxRSGTminStraight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">minRightGTmaxRS</span><span class="p">(</span><span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxRS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>

                <span class="c1">##########################################################</span>
                <span class="c1"># if S and L in the junction but not R</span>
                <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                    <span class="c1"># if RS is in the lanes but not LS</span>
                    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>  <span class="c1"># add all right turn traffic to the RS lane</span>

                        <span class="c1">#distribute the left-turn traffic between the left lanes and LS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>
                
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>

                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        

                        <span class="c1">#distributes the straight traffic between the S, RS and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

                        <span class="c1"># find the straight lane with the maximum flow</span>
                        <span class="n">maxStraight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
                        <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                        <span class="c1">#add the straight traffic to the LS and RS lanes</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#sets maxRS and maxLS</span>
                        <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                        <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">maxLSGTminLeft</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxLSGTminStraight</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxRSGTminStraight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxLSGTmaxRS</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                                
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxRSGTmaxLS</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                            
                            <span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">minLeftGTmaxLS</span><span class="p">(</span><span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxRS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxLS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>

                    <span class="c1"># if RS in lanes but not LS</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;LS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>  <span class="c1"># add all right turn traffic to the RS lane</span>

                        <span class="c1">#distribute the left-turn traffic between the left lanes and LS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>

                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        

                        <span class="c1">#distributes the straight traffic between the S and RS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

                        <span class="c1"># find the straight lane with the maximum flow</span>
                        <span class="n">maxStraight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
                        <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                        <span class="c1">#add the straight traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#sets maxRS</span>
                        <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxRSGTminStraight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxRS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>

                    <span class="c1">#if LS in lanes but not RS</span>
                    <span class="k">elif</span><span class="p">((</span><span class="s1">&#39;RS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="c1">#distribute the left-turn traffic between the left lanes and LS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>
                
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>

                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        

                        <span class="c1">#distributes the straight traffic between the S, RS and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

                        <span class="c1"># find the straight lane with the maximum flow</span>
                        <span class="n">maxStraight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
                        <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                        <span class="c1">#add the straight traffic to the LS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#sets maxLS                    </span>
                        <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">maxLSGTminLeft</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxLSGTminStraight</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">minLeftGTmaxLS</span><span class="p">(</span><span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxLS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>

                <span class="c1">##########################################################</span>
                <span class="c1"># if S in the junction but not R and L</span>
                <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;L&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                    <span class="c1"># if RS is in the lanes and LS</span>
                    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>  <span class="c1"># add all right turn traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>  <span class="c1"># add all left turn traffic to the LS lane</span>
                        
                        <span class="c1">#distributes the straight traffic between the S, RS and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

                        <span class="c1"># find the straight lane with the maximum flow</span>
                        <span class="n">maxStraight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
                        <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                        <span class="c1">#add the straight traffic to the LS and RS lanes</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#sets maxRS and maxLS</span>
                        <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                        <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxLSGTminStraight</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxRSGTminStraight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxLSGTmaxRS</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                                
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxRSGTmaxLS</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxRS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxLS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>

                    <span class="c1"># if LS in lanes but not RS</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;RS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>  <span class="c1"># add all left turn traffic to the LS lane</span>
                        
                        <span class="c1">#distributes the straight traffic between the S, RS and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

                        <span class="c1"># find the straight lane with the maximum flow</span>
                        <span class="n">maxStraight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
                        <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                        <span class="c1">#add the straight traffic to the LS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#sets maxLS</span>
                        <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxLSGTminStraight</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxLS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>

                    <span class="c1"># if RS in lanes but not LS</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;LS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>  <span class="c1"># add all right turn traffic to the RS lane</span>

                        <span class="c1">#distributes the straight traffic between the S, RS and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of straight lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>

                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the straight direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># itertates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the straight VPH for the lane, with the divided lane flow</span>

                        <span class="c1"># find the straight lane with the maximum flow</span>
                        <span class="n">maxStraight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
                        <span class="n">minStraight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>

                        <span class="c1">#add the straight traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#sets maxRS</span>
                        <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">maxRSGTminStraight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minStraight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>
                            
                            <span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span> <span class="o">=</span> <span class="n">minStraightGTmaxRS</span><span class="p">(</span><span class="n">minStraight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">SCounter</span><span class="p">)</span>


        <span class="k">def</span><span class="w"> </span><span class="nf">distributeElse</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Description: Distributes the junction if there is no LRS, LR or S lane in the junction</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">nonlocal</span> <span class="bp">self</span>

            <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">):</span>
                    <span class="c1">#distribute the left-turn traffic between the left lanes</span>
                    <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]))</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                    <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]))</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
            
                    <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                    <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                    <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                            <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                            <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>

                    <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                    <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">):</span>
                    <span class="c1">#divide the right turn traffic amongst the right turn lanes</span>
                    <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]))</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                    <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]))</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
            
                    <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                    <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the right direction</span>
                    <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                            <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided amount and the remainder</span>
                            <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided lane flow</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># defines initial values for maximum left and straight lane and maximum right and straight lane</span>
                <span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                <span class="n">RCounter</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            
                <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                    <span class="c1">#if LS and RS in the lanes</span>
                    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        
                        <span class="c1">#distribute the left-turn traffic between the left lanes and LS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>
                
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>

                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>


                        <span class="c1">#divide the right turn traffic amongst the right turn lanes and RS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the right direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided lane flow</span>
                        
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span> <span class="c1">#adds the right traffic to the RS lane</span>

                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        

                        <span class="c1">#distributes the straight traffic between the RS and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                        <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>

                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">maxRSGTminRight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">maxLSGTminLeft</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxLSGTmaxRS</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                                
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxRSGTmaxLS</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                            
                            <span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">minRightGTmaxRS</span><span class="p">(</span><span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                            <span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">minLeftGTmaxLS</span><span class="p">(</span><span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                    
                    <span class="c1">#if LS in lanes and not RS</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="c1"># adds all straight traffic to the LS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1">#distribute the left-turn traffic between the left lanes and LS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>
                
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>

                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>


                        <span class="c1">#divide the right turn traffic amongst the right turn lanes and RS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]))</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]))</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the right direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided lane flow</span>

                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
            
                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">maxLSGTminLeft</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                            
                            <span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">minLeftGTmaxLS</span><span class="p">(</span><span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
            
                    <span class="c1">#if RS in lanes and not LS</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="c1">#distribute the left-turn traffic between the left lanes and LS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]))</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]))</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>


                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>


                        <span class="c1">#divide the right turn traffic amongst the right turn lanes and RS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the right direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided amount and the remainder</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the right VPH for the lane, with the divided lane flow</span>
                        
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span> <span class="c1">#adds the right traffic to the RS lane</span>

                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        
                        <span class="c1"># adds all straight traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
            
                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>

                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">maxRSGTminRight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                            <span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">minRightGTmaxRS</span><span class="p">(</span><span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>

            
                <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                    <span class="c1"># if both LS and RS lanes in junction</span>
                    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
            
                        <span class="c1">#distribute the left-turn traffic between the left lanes and LS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>
                
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>

                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        

                        <span class="c1">#distributes the straight traffic between the RS and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                        <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="c1">#adds all right traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">maxLSGTminLeft</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxLSGTmaxRS</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                                
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxRSGTmaxLS</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                            
                            <span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">minLeftGTmaxLS</span><span class="p">(</span><span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
            
                    <span class="c1">#if LS in lanes and RS is not</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="c1"># adds all straight traffic to the LS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
            
                        <span class="c1">#distribute the left-turn traffic between the left lanes and LS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>
                
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>

                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>

                        <span class="c1">#adds all straight traffic to the LS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">maxLSGTminLeft</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">minLeft</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>
                            
                            <span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span> <span class="o">=</span> <span class="n">minLeftGTmaxLS</span><span class="p">(</span><span class="n">minLeft</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">LCounter</span><span class="p">)</span>

                    <span class="c1">#if RS in lanes and RS is not</span>
                    <span class="k">elif</span><span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
            
                        <span class="c1">#distribute the left-turn traffic between the left lane</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>

                        <span class="n">maxLeft</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>
                        <span class="n">minLeft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">])</span>

                        <span class="c1"># adds all straight traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                        <span class="c1">#adds all right traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
            

                <span class="k">elif</span><span class="p">((</span><span class="s1">&#39;L&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                    <span class="c1"># if both LS and RS lanes in junction</span>
                    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
            
                        <span class="c1">#distribute the left-turn traffic between the left lanes and LS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>
                
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>

                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        

                        <span class="c1">#distributes the straight traffic between the RS and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                        <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="c1">#adds all left traffic to the LS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>

                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">maxRSGTminRight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxLSGTmaxRS</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                                
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxRSGTmaxLS</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                            
                            <span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">minRightGTmaxRS</span><span class="p">(</span><span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                    <span class="c1">#if LS in lanes and RS is not</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="c1">#distribute the right-turn traffic between the right lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>  <span class="c1"># divides the vehicles by the number of left turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>

                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>

                        <span class="c1"># adds all straight traffic to the LS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                        <span class="c1">#adds all left traffic to the LS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                    <span class="c1">#if RS in lanes and RS is not</span>
                    <span class="k">elif</span><span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="c1"># adds all straight traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
            
                        <span class="c1">#distribute the right-turn traffic between the right lanes and RS</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># divides the vehicles by the number of right turning lanes (without remainders)</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># finds the remainder of this division between the lanes</span>
                
                        <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># initialises a first iteration check variable</span>
                        <span class="n">lanes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>  <span class="c1"># gets all of the lanes for the left direction</span>
                        <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="n">lanes</span><span class="p">:</span>  <span class="c1"># iterates over the lanes</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">firstIteration</span><span class="p">):</span>  <span class="c1"># checks if this is the first iteration</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">((</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane, with the divided amount plus the remainder of the division</span>
                                <span class="n">firstIteration</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lane</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>  <span class="c1"># updates the left VPH for the lane with the divided amount</span>
                
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span>

                        <span class="n">maxRight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>
                        <span class="n">minRight</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lane</span><span class="o">.</span><span class="n">totalFlow</span> <span class="k">for</span> <span class="n">lane</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">])</span>

                        <span class="c1">#adds all straight traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">maxRSGTminRight</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">minRight</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
                            
                            <span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span> <span class="o">=</span> <span class="n">minRightGTmaxRS</span><span class="p">(</span><span class="n">minRight</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">,</span> <span class="n">RCounter</span><span class="p">)</span>
            

                <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;L&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;R&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                    <span class="c1">#if LS and RS in lanes</span>
                    <span class="k">if</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        
                        <span class="c1">#distributes the straight traffic between the RS and LS lanes</span>
                        <span class="n">laneFlow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
                        <span class="n">remainder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="n">laneFlow</span> <span class="o">+</span> <span class="n">remainder</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="c1"># adds all right traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
            
                        <span class="c1"># adds all left traffic to the LS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

                        <span class="n">maxRS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>
                        <span class="n">maxLS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalFlow</span>

                        <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="k">while</span><span class="p">(</span><span class="n">changeMade</span><span class="p">):</span>
                            <span class="n">changeMade</span> <span class="o">=</span> <span class="kc">False</span>
                            
                            <span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxLSGTmaxRS</span><span class="p">(</span><span class="n">maxLS</span><span class="p">,</span> <span class="n">maxRS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
                                
                            <span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span> <span class="o">=</span> <span class="n">maxRSGTmaxLS</span><span class="p">(</span><span class="n">maxRS</span><span class="p">,</span> <span class="n">maxLS</span><span class="p">,</span> <span class="n">changeMade</span><span class="p">)</span>
            
                    <span class="c1">#if LS in lanes and not RS</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="c1"># adds all left traffic to the LS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                        <span class="c1"># adds all straight traffic to the LS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;LS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
            
                    <span class="c1">#if RS in lanes and not LS</span>
                    <span class="k">elif</span> <span class="p">((</span><span class="s1">&#39;LS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;RS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">)):</span>
                        <span class="c1"># adds all right traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>
                        <span class="c1"># adds all straight traffic to the RS lane</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;RS&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span>

        <span class="c1">#------------------------------------------#</span>
        <span class="c1">#dividing the flow of cycle or bus lanes</span>
        <span class="k">if</span> <span class="s1">&#39;CB&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">:</span> <span class="c1">#checks whether there is a cycle or bus lane</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">updateDirectionFlow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VPHFlowDirections</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rep&#39;</span><span class="p">)</span> <span class="c1">#sets the CB lane to have the CB direction flow</span>

        <span class="c1"># LR, LRS and S are exclusive from each other and so can&#39;t exist at the same time, therefore we consider the scenarios where each one exists and where none exist</span>
        <span class="k">if</span> <span class="s1">&#39;LR&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">:</span>  <span class="c1"># when there is an LR lane</span>
            <span class="c1"># LS, RS, S and LRS cannot exist with this lane type</span>
            <span class="n">distributeLRorLRS</span><span class="p">(</span><span class="s1">&#39;LR&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s1">&#39;LRS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">:</span>  <span class="c1"># when there is an LRS lane</span>
            <span class="c1"># LS, RS, S and LR cannot exist with this lane type</span>
            <span class="n">distributeLRorLRS</span><span class="p">(</span><span class="s1">&#39;LRS&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="s1">&#39;S&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lanes</span><span class="p">:</span>  <span class="c1"># when there is an S lane</span>
            <span class="c1"># LR and LRS cannot exist with this lane type</span>
            <span class="n">distributeS</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># when there are no S, LR or LRS lanes</span>
            <span class="n">distributeElse</span><span class="p">()</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Andreas Masterton, Jingwei Liu, Lewis Ford, Rishi Devarakonda, Sreyas Nagarajan, Subomi Olatunji Orisatade.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>